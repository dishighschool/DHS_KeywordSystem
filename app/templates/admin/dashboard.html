{% extends "admin/base.html" %}
{% block title %}後台儀表板{% endblock %}
{% block header_title %}儀表板{% endblock %}
{% block page_title %}儀表板總覽{% endblock %}
{% block page_subtitle %}歡迎回來,{{ current_user.username }}!管理你的學習關鍵字與站台設定。{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-auto ms-auto">
    <a class="btn btn-primary btn-lg rounded-pill px-4" href="{{ url_for('admin.create_keyword') }}">
      <i class="bi bi-plus-circle me-2"></i>新增關鍵字
    </a>
  </div>
</div>

{% if stats %}
<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="admin-card">
      <div class="admin-card-body text-center">
        <i class="bi bi-card-text text-primary mb-3" style="font-size: 2.5rem; opacity: 0.3;"></i>
        <div class="text-muted mb-2">關鍵字總數</div>
        <h2 class="display-4 fw-bold text-primary mb-0">{{ stats.keywords }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="admin-card">
      <div class="admin-card-body text-center">
        <i class="bi bi-folder text-success mb-3" style="font-size: 2.5rem; opacity: 0.3;"></i>
        <div class="text-muted mb-2">分類數量</div>
        <h2 class="display-4 fw-bold text-success mb-0">{{ stats.categories }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="admin-card">
      <div class="admin-card-body text-center">
        <i class="bi bi-link-45deg text-info mb-3" style="font-size: 2.5rem; opacity: 0.3;"></i>
        <div class="text-muted mb-2">導航連結</div>
        <h2 class="display-4 fw-bold text-info mb-0">{{ stats.nav_links }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-12">
    <div class="admin-card">
      <div class="admin-card-header">
        <h5 class="mb-0">
          <i class="bi bi-people me-2"></i>成員統計
        </h5>
      </div>
      <div class="admin-card-body">
        <div class="row text-center">
          <div class="col-md-4">
            <a href="{{ url_for('admin.manage_users') }}" class="text-decoration-none">
              <div class="p-3 rounded bg-light">
                <i class="bi bi-people-fill text-primary" style="font-size: 2rem;"></i>
                <div class="text-muted small mt-2">總成員數</div>
                <h3 class="mb-0 text-primary">{{ stats.total_users }}</h3>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a href="{{ url_for('admin.manage_users') }}" class="text-decoration-none">
              <div class="p-3 rounded bg-light">
                <i class="bi bi-shield-fill-check text-danger" style="font-size: 2rem;"></i>
                <div class="text-muted small mt-2">管理員</div>
                <h3 class="mb-0 text-danger">{{ stats.admin_users }}</h3>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a href="{{ url_for('admin.manage_users') }}" class="text-decoration-none">
              <div class="p-3 rounded bg-light">
                <i class="bi bi-check-circle-fill text-success" style="font-size: 2rem;"></i>
                <div class="text-muted small mt-2">啟用成員</div>
                <h3 class="mb-0 text-success">{{ stats.active_users }}</h3>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<div class="admin-card">
  <div class="admin-card-header">
    <h2 class="admin-card-title">
      <i class="bi bi-journal-text admin-card-icon"></i>
      我的學習關鍵字
    </h2>
  </div>
  <div class="admin-card-body">
    {% if my_keywords %}
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
          <tr>
            <th style="width: 40%;">標題</th>
            <th style="width: 20%;">分類</th>
            <th style="width: 20%;">最後更新</th>
            <th style="width: 20%;" class="text-end">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for keyword in my_keywords %}
          <tr>
            <td>
              <div class="fw-semibold">{{ keyword.title }}</div>
              <div class="text-muted small">{{ keyword.description_markdown|striptags|truncate(60) }}</div>
            </td>
            <td>
              <span class="badge bg-primary-subtle text-primary">{{ keyword.category.name }}</span>
            </td>
            <td>
              <small class="text-muted">
                <i class="bi bi-clock me-1"></i>{{ keyword.updated_at.strftime('%Y-%m-%d') }}
              </small>
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('main.keyword_detail', category_slug=keyword.category.name|slugify, slug=keyword.slug) }}" target="_blank" title="檢視">
                <i class="bi bi-eye"></i>
              </a>
              <a class="btn btn-sm btn-primary" href="{{ url_for('admin.edit_keyword', keyword_id=keyword.id) }}" title="編輯">
                <i class="bi bi-pencil"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-5">
      <i class="bi bi-inbox text-muted" style="font-size: 3rem; opacity: 0.3;"></i>
      <p class="text-muted mt-3 mb-0">尚未建立任何關鍵字，點選右上方按鈕開始新增。</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
